% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/fit_rbm.R
\name{FitRBM}
\alias{FitRBM}
\title{Fit Restricted Boltzmann Machine}
\usage{
FitRBM(
  seuratObject,
  visibleFeatures = NULL,
  hiddenFactors,
  partialCorrelations = NULL,
  assay = "RNA",
  layer = "counts",
  family = "zinb",
  minNonZero = 10,
  cd_k = 1,
  learning_rate = 0.01,
  n_epochs = 10,
  batch_size = 100,
  persistent = FALSE,
  momentum = 0.5,
  weight_decay = 1e-04,
  progressr = TRUE,
  parallel = FALSE,
  numWorkers = NULL,
  verbose = TRUE
)
}
\arguments{
\item{seuratObject}{A Seurat object or SeuratObject containing single-cell data.}

\item{visibleFeatures}{Character vector of feature (gene) names to use as the visible layer.
If NULL, uses all features (default: NULL).}

\item{hiddenFactors}{Character vector of metadata column names to use as hidden units.
These represent outcome or grouping variables.}

\item{partialCorrelations}{Optional. A PartialCorrelations object (output from
EstimatePartialCorrelations or EstimatePartialCorrelationsFromSeurat) containing
pre-computed partial correlations. If NULL or invalid, partial correlations will
be computed on-the-fly. Using pre-computed correlations is recommended for:
(1) inspecting correlations before fitting, (2) reusing across multiple RBM fits,
(3) saving computation time. Default: NULL.}

\item{assay}{Character string specifying which assay to use (default: "RNA").}

\item{layer}{Character string specifying which layer to use (default: "counts").}

\item{family}{Character string specifying the distribution family for pseudolikelihood estimation.
Options: "zinb" (zero-inflated negative binomial, default), "nb", "poisson", "gaussian".
Ignored if partialCorrelations is provided.}

\item{minNonZero}{Minimum number of non-zero observations required for a feature
to be included (default: 10). Ignored if partialCorrelations is provided.}

\item{cd_k}{Number of Gibbs sampling steps for Contrastive Divergence (default: 1).
Use cd_k=1 for CD-1, cd_k=5 for CD-5, etc.}

\item{learning_rate}{Learning rate for weight updates (default: 0.01).}

\item{n_epochs}{Number of training epochs for Contrastive Divergence (default: 10).}

\item{batch_size}{Batch size for mini-batch training (default: 100).}

\item{persistent}{Logical indicating whether to use Persistent Contrastive Divergence
(default: FALSE). If TRUE, maintains chains between batches.}

\item{momentum}{Momentum coefficient for weight updates (default: 0.5).}

\item{weight_decay}{L2 regularization coefficient (default: 0.0001).}

\item{progressr}{Logical indicating whether to use progressr for progress reporting
(default: TRUE).}

\item{parallel}{Logical indicating whether to use parallel processing (default: FALSE).}

\item{numWorkers}{Integer specifying number of workers for parallel processing.
If NULL, uses detectCores()-1 (default: NULL).}

\item{verbose}{Logical indicating whether to print progress messages (default: TRUE).}
}
\value{
An object of class "RBM" containing:
  \itemize{
    \item weights_per_layer: List of weight matrices per hidden layer
    \item visible_bias: Bias terms for visible units (features)
    \item hidden_bias_per_layer: List of bias terms per hidden layer
    \item partial_correlations: Full partial correlation matrix among visible features
    \item visible_features: Names of features in visible layer
    \item hidden_layers_info: Information about each hidden layer (type, encoding, etc.)
    \item family: Distribution family used for estimation
    \item training_error: Reconstruction error per epoch during training
    \item fit_info: Additional information about the fitting process
  }
}
\description{
Fits a Restricted Boltzmann Machine (RBM) to connect features from a Seurat object
to a hidden layer populated by metadata factors. The edges are estimated using
partial correlations via pseudolikelihood for the specified family, then trained
using Contrastive Divergence.
}
\details{
**Recommended Workflow:**
For best results, pre-compute partial correlations using EstimatePartialCorrelationsFromSeurat,
inspect them, then pass to FitRBM:
\preformatted{
pcor <- EstimatePartialCorrelationsFromSeurat(seurat_obj, family = "zinb", parallel = TRUE)
print(pcor)  # Inspect
rbm <- FitRBM(seurat_obj, hiddenFactors = "CellType", partialCorrelations = pcor)
}

The RBM is fit by:
1. Extracting expression data for specified features
2. Using pre-computed partial correlations OR computing them via pseudolikelihood
3. Initializing connections from features to hidden metadata factors (correlation-based)
4. Training weights using Contrastive Divergence (CD-k) or Persistent CD
5. Computing bias terms based on feature means and metadata distributions

The resulting model can be used for prediction, visualization, and understanding
relationships between gene expression and cell metadata.
}
\examples{
\dontrun{
# Recommended: Pre-compute partial correlations first
pcor <- EstimatePartialCorrelationsFromSeurat(
  seuratObject = pbmc,
  family = "zinb",
  parallel = TRUE
)

# Fit RBM with pre-computed partial correlations
rbm <- FitRBM(
  seuratObject = pbmc,
  hiddenFactors = "CellType",
  partialCorrelations = pcor,
  cd_k = 5,
  n_epochs = 20,
  parallel = TRUE
)

# Reuse partial correlations for another RBM with different hidden factors
rbm2 <- FitRBM(
  seuratObject = pbmc,
  hiddenFactors = c("CellType", "Treatment"),
  partialCorrelations = pcor,
  cd_k = 5,
  n_epochs = 20
)

# Legacy: Compute on-the-fly (still supported)
rbm_legacy <- FitRBM(
  seuratObject = pbmc,
  hiddenFactors = "CellType",
  family = "zinb",
  parallel = TRUE
)

# Access the weights and training error
print(rbm$weights_per_layer)
plot(rbm$training_error)
}
}
